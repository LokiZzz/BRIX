@page "/characters/{CharacterId:guid?}"

<div class="section">
    <div class="container block">
        <p class="title">@Character?.Name</p>
        <p class="subtitle">@Localization[nameof(Resource.Characters_Level)] @Character?.Level</p>
    </div>
    <Tab Class="is-centered is-boxed">
        <TabItem Title="@Localization[nameof(Resource.Character)]">
            <div class="card block">
                <div class="card-content">
                    <div class="is-flex is-justify-content-space-between">
                        <div>
                            <p class="title is-size-4">@Localization[nameof(Resource.Characters_Experience)]</p>
                            <p class="subtitle is-size-6">
                                <span>@Character?.Experience</span>
                                <span> / </span>
                                <span>@NextLevelOn</span>
                            </p>
                        </div>
                        <div>
                            <button class="button is-medium">
                                <span class="icon">
                                    <i class="fas fa-calculator"></i>
                                </span>
                            </button>
                        </div>
                    </div>
                </div>
                <div class="card-footer">
                    <progress class="progress is-success is-small m-3" value="@Character?.Experience" max="@NextLevelOn" />
                </div>
            </div>
        </TabItem>
        <TabItem Title="@Localization[nameof(Resource.Character_Abilities)]">
            <div class="notification">
                <p>Способности персонажа.</p>
            </div>
        </TabItem>
        <TabItem Title="@Localization[nameof(Resource.Character_Inventory)]">
            <div class="notification">
                <p>Основная информация о персонаже.</p>
            </div>
        </TabItem>
        <TabItem Title="@Localization[nameof(Resource.Character_Details)]">
            <div class="notification">
                <p>Детальная информация о персонаже.</p>
            </div>
        </TabItem>
    </Tab>
</div>

@code {
    [Parameter]
    public Guid? CharacterId { get; set; }

    public Character? Character { get; set; }

    public int NextLevelOn => ExperienceCalculator.GetExpForLevel(Character?.Level + 1 ?? 0);

    protected override async Task OnInitializedAsync()
    {
        base.OnInitialized();

        if (CharacterManager.EditingCharacter is not null)
        {
            Character = CharacterManager.EditingCharacter;
            CharacterId = Character.Id;
        }
        else if(CharacterId is not null)
        {
            Modal.IsBusy = true;
            Character = await CharacterManager.GetAsync(CharacterId.Value);
            Modal.IsBusy = false;

            if(Character is null)
            {
                Navigation.NavigateTo("/404");
            }

            CharacterManager.EditingCharacter = Character;
        }
    }
}
